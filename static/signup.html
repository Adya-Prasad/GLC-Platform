<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GLC Platform - Signup</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" type="image/x-icon" href="/static/img/favicon.ico">
    <link href="/static/styles.css" rel="stylesheet">

    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
            background-image: url('/static/img/signup-bg.png');
            background-size: cover;
            background-position: center;
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .status-message {
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body class="flex items-center justify-center">
    <div class="">
        <div class="text-center mb-10">
            <img src="/static/img/glc-logo.png" alt="GLC Logo" class="h-20 mx-auto mb-6">
            <h1 class="font-extrabold text-5xl">GLC Platform</h1>
            <p class="text-gray-500 mt-2">Welcome to 'Green Lending Cycle' Administration Platform</p>
        </div>

        <!-- Status Message -->
        <div id="status-message" class="hidden mb-4 p-4 rounded-xl text-center status-message"></div>

        <div id="auth-container" class="space-y-4">
            <!-- Role Selection Buttons -->
            <button id="btn-borrower" onclick="selectRole('borrower')"
                class="w-full btn-prim text-lg shadow-lg shadow-green-900/20">
                <svg width="24px" height="24px" viewBox="0 0 24 24" fill="none">
                    <path fill-rule="evenodd" clip-rule="evenodd"
                        d="M16 9C16 11.2091 14.2091 13 12 13C9.79086 13 8 11.2091 8 9C8 6.79086 9.79086 5 12 5C14.2091 5 16 6.79086 16 9ZM14 9C14 10.1046 13.1046 11 12 11C10.8954 11 10 10.1046 10 9C10 7.89543 10.8954 7 12 7C13.1046 7 14 7.89543 14 9Z"
                        fill="currentColor" />
                    <path fill-rule="evenodd" clip-rule="evenodd"
                        d="M12 1C5.92487 1 1 5.92487 1 12C1 18.0751 5.92487 23 12 23C18.0751 23 23 18.0751 23 12C23 5.92487 18.0751 1 12 1ZM3 12C3 14.0902 3.71255 16.014 4.90798 17.5417C6.55245 15.3889 9.14627 14 12.0645 14C14.9448 14 17.5092 15.3531 19.1565 17.4583C20.313 15.9443 21 14.0524 21 12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12ZM12 21C9.84977 21 7.87565 20.2459 6.32767 18.9878C7.59352 17.1812 9.69106 16 12.0645 16C14.4084 16 16.4833 17.1521 17.7538 18.9209C16.1939 20.2191 14.1881 21 12 21Z"
                        fill="currentColor" />
                </svg>
                <span>Enter as Borrower</span>
            </button>

            <button id="btn-lender" onclick="selectRole('lender')" class="w-full btn-prim text-lg shadow-lg">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M8 14v3m4-3v3m4-3v3M3 21h18M3 10h18M3 7l9-4 9 4M4 10h16v11H4V10z" />
                </svg>
                <span>Enter as Lender / Bank</span>
            </button>

            <!-- Login Form (Hidden by default) -->
            <div id="login-form" class="hidden fade-in space-y-4">
                <div class="text-center mb-2">
                    <span id="role-badge"
                        class="inline-block px-4 py-1 rounded-full text-sm font-semibold bg-green-100 text-green-800"></span>
                </div>

                <div>
                    <label id="name-label" class="block text-sm font-medium text-gray-700 mb-2">Organization
                        Name</label>
                    <input type="text" id="org-name" placeholder="Enter your organization name"
                        class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none transition-all text-lg">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">6-Digit Passcode</label>
                    <input type="text" id="passcode" placeholder="Enter 6-digit passcode" maxlength="6"
                        pattern="[0-9]{6}" inputmode="numeric"
                        class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none transition-all text-lg tracking-widest text-center font-mono"
                        onkeydown="if(event.key === 'Enter') submitLogin()"
                        oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 6)">
                    <p class="text-xs text-gray-500 mt-1 text-center">New user? Create your passcode. Existing? Enter
                        your passcode.</p>
                </div>

                <button id="submit-btn" onclick="submitLogin()"
                    class="w-full btn-prim text-lg shadow-lg shadow-green-900/20">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 7l5 5m0 0l-5 5m5-5H6" />
                    </svg>
                    <span>Continue</span>
                </button>

                <button onclick="resetForm()"
                    class="w-full py-2 text-gray-500 hover:text-gray-700 text-sm font-medium transition-colors">
                    ‚Üê Back to role selection
                </button>
            </div>
        </div>

        <p class="text-center text-gray-500 text-sm mt-8 gap5">‚Ä¢ Hackathon Version ‚Ä¢<br><b>üîí Your data is protected</b></p>
    </div>

    <script type="module">
        import { login } from '/static/frontend/auth.js';

        let selectedRole = null;

        window.selectRole = function (role) {
            selectedRole = role;
            hideStatusMessage();

            // Hide the opposite button, keep selected one visible but disabled
            if (role === 'borrower') {
                document.getElementById('btn-lender').classList.add('hidden');
                document.getElementById('btn-borrower').classList.add('opacity-50', 'pointer-events-none');
                document.getElementById('role-badge').textContent = 'üå± Borrower';
                document.getElementById('name-label').textContent = 'Organization Name';
            } else {
                document.getElementById('btn-borrower').classList.add('hidden');
                document.getElementById('btn-lender').classList.add('opacity-50', 'pointer-events-none');
                document.getElementById('role-badge').textContent = 'üè¶ Lender / Bank';
                document.getElementById('name-label').textContent = 'Bank / Institution Name';
            }

            // Show login form
            document.getElementById('login-form').classList.remove('hidden');

            // Focus on name input
            setTimeout(() => document.getElementById('org-name').focus(), 100);
        };

        window.resetForm = function () {
            selectedRole = null;
            hideStatusMessage();
            document.getElementById('btn-borrower').classList.remove('hidden', 'opacity-50', 'pointer-events-none');
            document.getElementById('btn-lender').classList.remove('hidden', 'opacity-50', 'pointer-events-none');
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('org-name').value = '';
            document.getElementById('passcode').value = '';
        };

        function showStatusMessage(message, type) {
            const el = document.getElementById('status-message');
            el.classList.remove('hidden', 'bg-green-100', 'text-green-800', 'bg-red-100', 'text-red-800', 'bg-blue-100', 'text-blue-800');

            if (type === 'success') {
                el.classList.add('bg-green-100', 'text-green-800');
            } else if (type === 'error') {
                el.classList.add('bg-red-100', 'text-red-800');
            } else {
                el.classList.add('bg-blue-100', 'text-blue-800');
            }

            el.innerHTML = message;
        }

        function hideStatusMessage() {
            document.getElementById('status-message').classList.add('hidden');
        }

        window.submitLogin = async function () {
            const name = document.getElementById('org-name').value.trim();
            const passcode = document.getElementById('passcode').value.trim();

            // Validate role selection
            if (!selectedRole) {
                showStatusMessage('‚ö†Ô∏è Please select a role: Borrower or Lender', 'error');
                return;
            }

            // Validate name
            if (!name) {
                document.getElementById('org-name').classList.add('ring-2', 'ring-red-500');
                document.getElementById('org-name').focus();
                showStatusMessage('‚ö†Ô∏è Please enter your organization name', 'error');
                setTimeout(() => document.getElementById('org-name').classList.remove('ring-2', 'ring-red-500'), 2000);
                return;
            }

            // Validate passcode
            if (!passcode || passcode.length !== 6 || !/^\d{6}$/.test(passcode)) {
                document.getElementById('passcode').classList.add('ring-2', 'ring-red-500');
                document.getElementById('passcode').focus();
                showStatusMessage('‚ö†Ô∏è Passcode must be exactly 6 digits', 'error');
                setTimeout(() => document.getElementById('passcode').classList.remove('ring-2', 'ring-red-500'), 2000);
                return;
            }

            // Disable submit button
            const btn = document.getElementById('submit-btn');
            btn.disabled = true;
            btn.innerHTML = '<span class="animate-spin">‚ü≥</span> Logging in...';

            const result = await login(selectedRole, name, passcode);

            if (result.success) {
                if (result.status === 'new_user') {
                    showStatusMessage('üéâ Welcome! Your account has been created.', 'success');
                } else {
                    showStatusMessage('‚úÖ Welcome back, ' + result.name + '!', 'success');
                }
                setTimeout(() => window.location.href = '/', 1500);
            } else {
                btn.disabled = false;
                btn.innerHTML = '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/></svg><span>Continue</span>';

                if (result.status === 'passcode_mismatch') {
                    showStatusMessage('‚ùå <b>Incorrect passcode!</b> The passcode does not match this account.', 'error');
                    document.getElementById('passcode').classList.add('ring-2', 'ring-red-500');
                    document.getElementById('passcode').focus();
                    document.getElementById('passcode').select();
                } else {
                    showStatusMessage('‚ùå <b>Error:</b> ' + (result.error || 'Login failed'), 'error');
                }
            }
        };

        // Redirect if already logged in
        if (localStorage.getItem('glc_user')) {
            window.location.href = '/';
        }
    </script>
</body>

</html>